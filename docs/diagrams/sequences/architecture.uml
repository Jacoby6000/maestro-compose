   General CRUD Application Architecture
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^


                            ┌──────────┐                      ┌─────┐                         ┌──────────┐                                          ┌───────────┐                                       ┌───────────────┐
                            │WebService│                      │Cache│                         │Validation│                                          │Application│                                       │ExternalService│
                            └────┬─────┘                      └──┬──┘                         └────┬─────┘                                          └─────┬─────┘                                       └───────┬───────┘
             Request             │                               │                                 │                                                      │                                                     │
─────────────────────────────────>                               │                                 │                                                      │                                                     │
                                 │                               │                                 │                                                      │                                                     │
                                 │                               │                                 │                                                      │                                                     │
                  ╔══════════════╪══╤════════════════════════════╪═════════════════════════════════╪════╗                                                 │                                                     │
                  ║ AUTHENTICATION  │                            │                                 │    ║                                                 │                                                     │
                  ╟─────────────────┘    Request.authToken       │                                 │    ║                                                 │                                                     │
                  ║              │ ──────────────────────────────>                                 │    ║                                                 │                                                     │
                  ║              │                               │                                 │    ║                                                 │                                                     │
                  ║              │                               │────┐                                 ║                                                 │                                                     │
                  ║              │                               │    │ Request.authToken => Boolean    ║                                                 │                                                     │
                  ║              │                               │<───┘                                 ║                                                 │                                                     │
                  ║              │                               │                                 │    ║                                                 │                                                     │
                  ║              │            Boolean            │                                 │    ║                                                 │                                                     │
                  ║              │ <──────────────────────────────                                 │    ║                                                 │                                                     │
                  ╚══════════════╪═══════════════════════════════╪═════════════════════════════════╪════╝                                                 │                                                     │
                                 │                               │                                 │                                                      │                                                     │
                                 │                               │                                 │                                                      │                                                     │
  ╔══════╤═══════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═══════════════════════════════════════════════════════════════════════════════════════════════╗
  ║ ALT  │  case true            │                               │                                 │                                                      │                                                     │                                                                                               ║
  ╟──────┘                       │                               │                                 │                                                      │                                                     │                                                                                               ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                               ║
  ║               ╔══════════════╪═══╤═══════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪════╗                                                │                                                                                               ║
  ║               ║ DATA VALIDATION  │                           │                                 │                                                      │    ║                                                │                                                                                               ║
  ║               ╟───────────────────┐                                                            │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │    │ Request.json => FooRequest                                 │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │<───┘                                                            │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │                               │                                 │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │                            FooRequest                           │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │ ────────────────────────────────────────────────────────────────>                                                      │    ║                                                │                                                                                               ║
  ║               ║              │                               │                                 │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │                               │                                 │────┐                                                      ║                                                │                                                                                               ║
  ║               ║              │                               │                                 │    │ FooRequest => ValidationFailures Ior ValidatedFoo    ║                                                │                                                                                               ║
  ║               ║              │                               │                                 │<───┘                                                      ║                                                │                                                                                               ║
  ║               ║              │                               │                                 │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │               ValidationFailures Ior ValidatedFoo               │                                                      │    ║                                                │                                                                                               ║
  ║               ║              │ <────────────────────────────────────────────────────────────────                                                      │    ║                                                │                                                                                               ║
  ║               ╚══════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪════╝                                                │                                                                                               ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                               ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                               ║
  ╔══════╤═══════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═════════════════════════════════════════════════════════════════════════════════════╗         ║
  ║ ALT  │  case Ior.Right(validated) || (Ior.Both(_, validated) && ignoreWarnings == "true")      │                                                      │                                                     │                                                                                     ║         ║
  ╟──────┘                       │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                      ValidatedFoo                                                      │                                                     │                                                                                     ║         ║
  ║                              │ ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────>                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                            ╔═════════════════╤═══════╪═════════════════════════════════════════════════════╪══════════════════════════════════════════════════════════════════════════╗          ║         ║
  ║                              │                               │                                 │                            ║ BUSINESS LOGIC  │       │                                                     │                                                                          ║          ║         ║
  ║                              │                               │                                 │                            ╟─────────────────┘       │────┐                                                │                                                                          ║          ║         ║
  ║                              │                               │                                 │                            ║                         │    │ ValidatedFoo => ProcessedFoo[1]                │                                                                          ║          ║         ║
  ║                              │                               │                                 │                            ║                         │<───┘                                                │                                                                          ║          ║         ║
  ║                              │                               │                                 │                            ║                         │                                                     │                                                                          ║          ║         ║
  ║                              │                               │                                 │                            ║                         │                                                     │                                                                          ║          ║         ║
  ║                              │                               │                                 │                            ║         ╔═══════╤═══════╪═════════════════════════════════════════════════════╪════════════════════════════════════════════════════════════════╗         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║ LOOP  │  until request has been processed in to a response          │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ╟───────┘       │                                                     │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │────┐                                                                                                                 ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │    │ ProcessedFoo[N].bar => ExternalServiceRequest[N]                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │<───┘                                                                                                                 ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │              ExternalServiceRequest[N]              │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │ ────────────────────────────────────────────────────>                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │────┐                                                           ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │    │ ExternalServiceRequest[N] => ExternalServiceResponse[N]   ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │<───┘                                                           ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │              ExternalServiceResponse[N]             │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │ <────────────────────────────────────────────────────                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │                                                     │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │────┐                                                │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │    │ ExternalServiceResponse[N] => ProcessedFoo[++N]│                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ║               │<───┘                                                │                                                                ║         ║          ║         ║
  ║                              │                               │                                 │                            ║         ╚═══════════════╪═════════════════════════════════════════════════════╪════════════════════════════════════════════════════════════════╝         ║          ║         ║
  ║                              │                               │                                 │                            ╚═════════════════════════╪═════════════════════════════════════════════════════╪══════════════════════════════════════════════════════════════════════════╝          ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │────┐                                                │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │    │ ProcessedFoo[N] => Task[Response]              │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │<───┘                                                │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                     Task[Response]                                                     │                                                     │                                                                                     ║         ║
  ║                              │ <───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║      Task[Response]          │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
<─────────────────────────────────                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ╠══════════════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═════════════════════════════════════════════════════════════════════════════════════╣         ║
  ║ [case Ior.Left[ValidationFailures]]                          │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                     Task[ValidationFailures]                    │                                                      │                                                     │                                                                                     ║         ║
  ║                              │ <────────────────────────────────────────────────────────────────                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║ Task[ValidationFailures]     │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
<─────────────────────────────────                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ╠══════════════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═════════════════════════════════════════════════════════════════════════════════════╣         ║
  ║ [case Ior.Both[ValidationFailures, _] && ignoreWarnings == "false"]                            │                                                      │                                                     │                                                                                     ║         ║
  ║                              │                     Task[ValidationFailures]                    │                                                      │                                                     │                                                                                     ║         ║
  ║                              │ <────────────────────────────────────────────────────────────────                                                      │                                                     │                                                                                     ║         ║
  ║                              │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ║ Task[ValidationFailures]     │                               │                                 │                                                      │                                                     │                                                                                     ║         ║
<─────────────────────────────────                               │                                 │                                                      │                                                     │                                                                                     ║         ║
  ╚══════════════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═════════════════════════════════════════════════════════════════════════════════════╝         ║
  ╠══════════════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═══════════════════════════════════════════════════════════════════════════════════════════════╣
  ║ [case false]                 │                               │                                 │                                                      │                                                     │                                                                                               ║
  ║Task[AuthorizationFailure]    │                               │                                 │                                                      │                                                     │                                                                                               ║
<─────────────────────────────────                               │                                 │                                                      │                                                     │                                                                                               ║
  ╚══════════════════════════════╪═══════════════════════════════╪═════════════════════════════════╪══════════════════════════════════════════════════════╪═════════════════════════════════════════════════════╪═══════════════════════════════════════════════════════════════════════════════════════════════╝
                            ┌────┴─────┐                      ┌──┴──┐                         ┌────┴─────┐                                          ┌─────┴─────┐                                       ┌───────┴───────┐
                            │WebService│                      │Cache│                         │Validation│                                          │Application│                                       │ExternalService│
                            └──────────┘                      └─────┘                         └──────────┘                                          └───────────┘                                       └───────────────┘

@startuml
title General CRUD Application Architecture
-> WebService : Request
group Authentication
        WebService -> Cache : Request.authToken
        Cache -> Cache : Request.authToken => Boolean
        Cache -> WebService : Boolean
end
alt case true
        group Data Validation
                WebService -> WebService : Request.json => FooRequest
                WebService -> Validation : FooRequest
                Validation -> Validation : FooRequest => ValidationFailures Ior ValidatedFoo
                Validation -> WebService : ValidationFailures Ior ValidatedFoo
        end
        alt case Ior.Right(validated) || (Ior.Both(_, validated) && ignoreWarnings == "true")
                WebService -> Application : ValidatedFoo
                group Business logic
                        Application -> Application : ValidatedFoo => ProcessedFoo[1]
                        loop until request has been processed in to a response
                                Application -> Application: ProcessedFoo[N].bar => ExternalServiceRequest[N]
                                Application -> ExternalService : ExternalServiceRequest[N]
                                ExternalService -> ExternalService : ExternalServiceRequest[N] => ExternalServiceResponse[N]
                                ExternalService -> Application : ExternalServiceResponse[N]
                                Application -> Application : ExternalServiceResponse[N] => ProcessedFoo[++N]
                        end
                end
                Application -> Application : ProcessedFoo[N] => Task[Response]
                Application -> WebService : Task[Response]
                <- WebService : Task[Response]
        else case Ior.Left[ValidationFailures]
                Validation -> WebService : Task[ValidationFailures]
                <- WebService : Task[ValidationFailures]
        else case Ior.Both[ValidationFailures, _] && ignoreWarnings == "false"
                Validation -> WebService : Task[ValidationFailures]
                <- WebService : Task[ValidationFailures]
        end
else case false
        <- WebService : Task[AuthorizationFailure]
end
@enduml
